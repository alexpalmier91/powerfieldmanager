{# app/templates/superuser/labo_sales_import_sync.html #}
{% extends "_layouts/app.html" %}

{% block title %}Import automatique ventes labos{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1 class="mb-3">Automatisation de l'import des documents de vente</h1>

  <div class="card mb-4">
    <div class="card-header">
      <strong>Choisissez un laboratoire</strong>
    </div>
    <div class="card-body">
      <select id="labo-select" class="form-select">
        <option value="">-- S√©lectionnez un labo --</option>
        {% for labo in labos %}
          <option value="{{ labo.id }}">{{ labo.name }}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  <div id="sales-import-form-wrap" class="card" style="display:none;">
    <div class="card-header d-flex justify-content-between align-items-center">
      <div>
        <strong>Configuration de l'import des ventes</strong>
        <span id="selected-labo-name" class="text-muted ms-2"></span>
      </div>
      <span id="sales-import-status" class="badge bg-secondary"></span>
    </div>

    <div class="card-body">
      <form id="sales-import-sync-form">
        <div class="form-check form-switch mb-3">
          <input class="form-check-input" type="checkbox" id="enabled">
          <label class="form-check-label" for="enabled">
            Activer l'import automatique des ventes pour ce labo
          </label>
        </div>

        <div class="mb-3">
          <label for="file_url" class="form-label">URL du fichier Excel (Google Drive, etc.)</label>
          <input type="text" class="form-control" id="file_url" placeholder="https://...">
          <div class="form-text">
            Lien direct vers le fichier Excel contenant les ventes (factures, commandes, avoirs).
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-4">
            <label for="run_at" class="form-label">Heure d'import quotidienne (HH:MM)</label>
            <input type="time" class="form-control" id="run_at">
            <div class="form-text">
              Pour l'instant, la t√¢che Celery tourne une fois par nuit.
              Ce champ est anticip√© pour affiner la planification.
            </div>
          </div>
        </div>

        <div class="mb-3 d-flex flex-wrap align-items-center" style="gap:8px;">
          <button type="button" id="btn-save-config" class="btn btn-primary btn-sm">
            üíæ Enregistrer la configuration
          </button>

          <button type="button" id="btn-run-now" class="btn btn-warning btn-sm" disabled>
            üîÅ Importer les ventes maintenant
          </button>

          <span id="sales-import-loader" style="display:none;" class="ms-2">
            ‚è≥ Traitement en cours...
          </span>
        </div>

        <div class="mb-3">
          <label class="form-label">R√©sum√© du dernier import manuel</label>
          <div id="sales-import-result" class="small text-muted mb-3 border rounded p-2 bg-light"></div>
        </div>

        <div class="mb-3">
          <label class="form-label">Derni√®re ex√©cution (auto ou manuelle)</label>
          <div id="last-run-info" class="small text-muted">
            Aucune ex√©cution pour le moment.
          </div>
        </div>

        <div id="sales-import-error" class="alert alert-danger mt-3" style="display:none;"></div>
        <div id="sales-import-success" class="alert alert-success mt-3" style="display:none;"></div>
      </form>
    </div>
  </div>
</div>

<script src="/static/superuser/labo_sales_import_sync.js"></script>
{% endblock %}
