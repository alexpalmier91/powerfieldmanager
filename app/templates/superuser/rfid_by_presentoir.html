{# app/templates/superuser/rfid_by_presentoir.html #}
{% extends "_layouts/app.html" %}

{% block title %}Tags RFID par présentoir{% endblock %}
{% block breadcrumb %}RFID / Tags par présentoir{% endblock %}

{% block content %}
  <h1>Tags RFID par présentoir</h1>

  <div class="card" style="margin-top:16px;">
    <p style="color:#6b7280; font-size:0.9rem;">
      Affiche, pour chaque présentoir, les tags RFID actuellement détectés
      (DisplayItem actifs).
    </p>
  </div>

  {% if presentoir_groups %}
    {% for group in presentoir_groups %}
      {% set pres = group.presentoir %}
      {% set client = group.client %}
      <div class="card" style="margin-top:16px;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div>
            <h3 style="margin:0;">
              Présentoir {{ pres.code }}
              {% if pres.name %} – {{ pres.name }}{% endif %}
            </h3>
            <p style="margin:4px 0; color:#6b7280; font-size:0.9rem;">
              Client :
              {% if client %}
                [{{ client.id }}] {{ client.company_name }}
              {% else %}
                <em>Aucun client assigné</em>
              {% endif %}
              · Produits présents : {{ group.tags|length }}
            </p>
          </div>
          <div>
            <a href="/superuser/presentoirs/{{ pres.id }}"
               class="btn">
              Détail présentoir →
            </a>
          </div>
        </div>

        {% if group.tags %}
          <table class="table" style="margin-top:8px;">
            <thead>
              <tr>
                <th>EPC</th>
                <th>SKU</th>
                <th>Produit</th>
                <th>Statut</th>
                <th>Niveau / Position</th>
                <th>Dernière vue</th>
              </tr>
            </thead>
            <tbody>
              {% for t in group.tags %}
                <tr>
                  <td style="font-family:monospace; font-size:0.85rem;">
                    {{ t.epc }}
                  </td>
                  <td>{{ t.sku or "-" }}</td>
                  <td>
                    {% if t.product_id %}
                      [{{ t.product_id }}] {{ t.product_name or "-" }}
                    {% else %}
                      -
                    {% endif %}
                  </td>
                  <td>{{ t.status }}</td>
                  <td>
                    {% if t.level_index is not none or t.position_index is not none %}
                      Niv {{ t.level_index if t.level_index is not none else "-" }},
                      Pos {{ t.position_index if t.position_index is not none else "-" }}
                    {% else %}
                      -
                    {% endif %}
                  </td>
                  <td>{{ t.last_seen_at or "-" }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p style="margin-top:8px;">Aucun tag actif sur ce présentoir.</p>
        {% endif %}
      </div>
    {% endfor %}
  {% else %}
    <div class="card" style="margin-top:16px;">
      <p>Aucun présentoir avec tags actifs pour le moment.</p>
    </div>
  {% endif %}
{% endblock %}
