{% extends "_layouts/app.html" %}
{% block title %}Import des ventes{% endblock %}

{% block content %}
<div class="card">
  <div class="card-header">
    <h2>Import des ventes labo</h2>
    <p class="text-muted">
      Importez vos documents de ventes (factures FA‚Ä¶, commandes CO‚Ä¶, avoirs AV/AW‚Ä¶) au format Excel ou CSV.
    </p>
  </div>

  <div class="card-body">
    <form id="sales-import-form">
      <div class="form-group mb-3">
        <label for="file">Fichier de ventes (.xlsx / .csv)</label>
        <input type="file" class="form-control" id="file" name="file" required>
      </div>

      <button type="submit" id="btn-import" class="btn btn-primary">
        üì• Importer
      </button>

      <span id="sales-import-loader" class="ms-2" style="display:none;">
        ‚è≥ Importation en cours‚Ä¶
      </span>
    </form>

    <div id="sales-import-result" class="mt-4" style="display:none;">
      <h5>R√©sultat de l‚Äôimport</h5>
      <pre id="sales-import-json" class="bg-light p-2 small"></pre>
    </div>

    <div id="sales-import-warnings" class="mt-4" style="display:none;">
      <h6>Avertissements</h6>
      <ul id="sales-import-warnings-list" class="small"></ul>
    </div>

    <!-- Aide : colonnes attendues dans le fichier Excel / CSV -->
    <div class="mt-4">
      <h5>Colonnes attendues dans le fichier de ventes</h5>
      <p class="text-muted small">
        Les noms ci-dessous correspondent aux colonnes internes. Votre fichier peut utiliser des intitul√©s proches
        (ex. <code>Num commande</code> sera mapp√© vers <code>order_number</code>, <code>Code client</code> vers <code>client_code</code>, etc.).
      </p>

      <h6>Colonnes obligatoires</h6>
      <table class="table table-sm table-bordered align-middle">
        <thead class="table-light">
          <tr>
            <th style="width: 220px;">Nom de colonne attendu</th>
            <th>Description</th>
            <th>Exemples d‚Äôintitul√©s accept√©s</th>
          </tr>
        </thead>
        <tbody class="small">
          <tr>
            <td><code>order_number</code></td>
            <td>
              Num√©ro du document (facture, bon de commande, avoir).<br>
              Permet d‚Äôidentifier de fa√ßon unique chaque document.
            </td>
            <td>
              <code>Order number</code>, <code>Num commande</code>, <code>Commande</code>, <code>N¬∞ commande</code>‚Ä¶
            </td>
          </tr>
          <tr>
            <td><code>order_date</code></td>
            <td>
              Date du document (date de facture ou de commande).<br>
              Format conseill√© : <code>JJ/MM/AAAA</code> ou <code>AAAA-MM-JJ</code>.
            </td>
            <td>
              <code>Order date</code>, <code>Date</code>, <code>Date commande</code>‚Ä¶
            </td>
          </tr>
          <tr>
            <td><code>client_code</code></td>
            <td>
              Code client chez le labo (doit correspondre au code client utilis√© dans ZenHub pour ce labo).<br>
              C‚Äôest ce code qui permet de rattacher la vente au bon client.
            </td>
            <td>
              <code>Client code</code>, <code>Code client</code>, <code>Code labo</code>, <code>Code labo client</code>‚Ä¶
            </td>
          </tr>
          <tr>
            <td><code>sku</code></td>
            <td>
              R√©f√©rence produit (SKU) utilis√©e dans ZenHub pour ce labo.<br>
              Doit correspondre exactement aux r√©f√©rences de vos fiches produits.
            </td>
            <td>
              <code>SKU</code>, <code>R√©f√©rence</code>‚Ä¶
            </td>
          </tr>
          <tr>
            <td><code>qty</code></td>
            <td>
              Quantit√© vendue pour la ligne de document.
            </td>
            <td>
              <code>Qty</code>, <code>Quantit√©</code>, <code>Qte</code>, <code>Qt√©</code>‚Ä¶
            </td>
          </tr>
        </tbody>
      </table>

      <h6 class="mt-3">Colonnes optionnelles (fortement recommand√©es)</h6>
      <table class="table table-sm table-bordered align-middle">
        <thead class="table-light">
          <tr>
            <th style="width: 220px;">Nom de colonne attendu</th>
            <th>Description</th>
            <th>Exemples d‚Äôintitul√©s accept√©s</th>
          </tr>
        </thead>
        <tbody class="small">
          <tr>
            <td><code>delivery_date</code></td>
            <td>
              Date de livraison pr√©vue ou r√©elle.<br>
              Si absente, seule la date de document sera utilis√©e.
            </td>
            <td>
              <code>Delivery date</code>, <code>Date livraison</code>, <code>Date de livraison</code>‚Ä¶
            </td>
          </tr>
          <tr>
            <td><code>price_ht</code></td>
            <td>
              Prix unitaire HT de la ligne.<br>
              Si <code>total_ht</code> est pr√©sent, les deux seront contr√¥l√©s.
            </td>
            <td>
              <code>Price HT</code>, <code>Prix HT</code>, <code>PU HT</code>, <code>Unit HT</code>‚Ä¶
            </td>
          </tr>
          <tr>
            <td><code>total_ht</code></td>
            <td>
              Total HT de la ligne (quantit√© √ó prix).<br>
              Si absent, il sera recalcul√© √† partir de <code>qty</code> et <code>price_ht</code>.
            </td>
            <td>
              <code>Total HT</code>, <code>Montant HT</code>, <code>Ligne HT</code>‚Ä¶
            </td>
          </tr>
          <tr>
            <td><code>representant</code></td>
            <td>
              Nom de l‚Äôagent / commercial ayant g√©n√©r√© la vente.<br>
              Sert √† rattacher le document √† un agent si possible (r√©solution par nom).
            </td>
            <td>
              <code>Repr√©sentant</code>, <code>Agent</code>, <code>Commercial</code>, <code>Nom</code>‚Ä¶
            </td>
          </tr>
          <tr>
            <td><code>ean13</code></td>
            <td>
              Code-barres du produit (EAN-13).<br>
              Optionnel, utilis√© uniquement pour information.
            </td>
            <td>
              <code>EAN</code>, <code>EAN13</code>, <code>Code barre</code>‚Ä¶
            </td>
          </tr>
        </tbody>
      </table>

      <p class="text-muted small mb-0">
        Si vos intitul√©s de colonnes ne correspondent pas exactement, l‚Äôoutil essaiera de les
        reconna√Ætre automatiquement (ex. <code>Num commande</code> ‚Üí <code>order_number</code>,
        <code>Code client</code> ‚Üí <code>client_code</code>, etc.).<br>
        En cas de doute, n‚Äôh√©sitez pas √† demander un mod√®le de fichier.
      </p>
    </div>
  </div>
</div>

<script src="{{ url_for('static', path='/labo/pages/sales_import.js') }}"></script>
{% endblock %}
