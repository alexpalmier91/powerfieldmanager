{# =======================================================
   MENU SUPERUSER
   ======================================================= #}

{# -----------------------
   Liens principaux
   ----------------------- #}
{% set base_items = [
  {"href": "/superuser/dashboard", "label": "Dashboard",          "icon": "ğŸ› ï¸"},
  {"href": "/superuser/clients",   "label": "Clients",            "icon": "ğŸ‘¥"},
  {"href": "/superuser/labos",      "label": "Labos",              "icon": "ğŸ­"},
  {"href": "/superuser/labos/new",  "label": "Nouveau labo",       "icon": "â•"},
  {"href": "/superuser/orders",    "label": "Commandes globales", "icon": "ğŸ“„"}
] %}

{# -----------------------
   Liens IMPORTATION
   ----------------------- #}
{% set import_items = [
  {"href": "/superuser/import/clients",            "label": "Importation clients",           "icon": "â¬†ï¸"},
  {"href": "/superuser/import/client-mapping",     "label": "Mapping clients / labos",       "icon": "ğŸ”—"},
  {"href": "/superuser/import/agent-client",       "label": "Matching clients / agents",     "icon": "ğŸ§©"},
  {"href": "/superuser/import/agent-orders",       "label": "Import commandes agents",       "icon": "ğŸ“¦"},
  {"href": "/superuser/agent-orders/auto-import",  "label": "Import auto commandes agents",  "icon": "âš™ï¸"},
  {"href": "/superuser/labos/sales-import-sync",   "label": "Import auto documents labos",   "icon": "ğŸ“‘"},
  {"href": "/superuser/labos/stock-sync",          "label": "Synchronisation stock labos",   "icon": "ğŸ“Š"},
  {"href": "/superuser/import/product-prestashop", "label": "Import produits PrestaShop",    "icon": "ğŸ›’"},
  {"href": "/superuser/imports",                   "label": "Imports & Jobs",                "icon": "ğŸšš"}
] %}

{# -----------------------
   Liens PRÃ‰SENTOIRS
   ----------------------- #}
{% set presentoir_items = [
  {"href": "/superuser/presentoirs",        "label": "PrÃ©sentoirs RFID",    "icon": "ğŸ“¡"},
  {"href": "/superuser/display-products",   "label": "Display Products",    "icon": "ğŸ§¾"},
  {"href": "/superuser/rfid/by-presentoir", "label": "Tags par prÃ©sentoir", "icon": "ğŸ“¦"},
  {"href": "/superuser/rfid/by-client",     "label": "Tags par client",     "icon": "ğŸª"},
  {"href": "/superuser/rfid-tags",          "label": "Tous les tags",       "icon": "ğŸ·ï¸"},
  {"href": "/superuser/presentoir-clients", "label": "Clients prÃ©sentoirs", "icon": "ğŸª"}
] %}

{% set path = request.url.path %}

{# -----------------------
   DÃ©tection menus actifs
   ----------------------- #}
{% set ns = namespace(import_active=false, presentoir_active=false) %}

{% for it in import_items %}
  {% if path.startswith(it.href) %}
    {% set ns.import_active = true %}
  {% endif %}
{% endfor %}

{% for it in presentoir_items %}
  {% if path.startswith(it.href) %}
    {% set ns.presentoir_active = true %}
  {% endif %}
{% endfor %}

<nav class="menu" role="navigation">

  {% for it in base_items %}
    {% set active = path.startswith(it.href) %}
    <a class="item {{ 'active' if active }}" href="{{ it.href }}">
      <span class="icon">{{ it.icon }}</span>
      <span class="label">{{ it.label }}</span>
    </a>
  {% endfor %}

  <div class="item import-toggle {{ 'active' if ns.import_active }}"
       data-import-toggle
       style="display:flex; justify-content:space-between; cursor:pointer;">
    <div style="display:flex; gap:8px;">
      <span class="icon">â¬†ï¸</span>
      <span class="label">Importation</span>
    </div>
    <span class="chevron" data-import-chevron>
      {{ 'â–¾' if ns.import_active else 'â–¸' }}
    </span>
  </div>

  <div class="import-submenu"
       data-import-submenu
       style="margin-left:20px; {{ '' if ns.import_active else 'display:none;' }}">
    {% for it in import_items %}
      {% set active = path.startswith(it.href) %}
      <a class="item {{ 'active' if active }}" href="{{ it.href }}">
        <span class="icon">{{ it.icon }}</span>
        <span class="label">{{ it.label }}</span>
      </a>
    {% endfor %}
  </div>

  <div class="item presentoir-toggle {{ 'active' if ns.presentoir_active }}"
       data-presentoir-toggle
       style="display:flex; justify-content:space-between; cursor:pointer;">
    <div style="display:flex; gap:8px;">
      <span class="icon">ğŸ“¡</span>
      <span class="label">PrÃ©sentoir connectÃ©</span>
    </div>
    <span class="chevron" data-presentoir-chevron>
      {{ 'â–¾' if ns.presentoir_active else 'â–¸' }}
    </span>
  </div>

  <div class="presentoir-submenu"
       data-presentoir-submenu
       style="margin-left:20px; {{ '' if ns.presentoir_active else 'display:none;' }}">
    {% for it in presentoir_items %}
      {% set active = path.startswith(it.href) %}
      <a class="item {{ 'active' if active }}" href="{{ it.href }}">
        <span class="icon">{{ it.icon }}</span>
        <span class="label">{{ it.label }}</span>
      </a>
    {% endfor %}
  </div>

  <button type="button" id="logoutBtn">DÃ©connexion</button>

</nav>

<script>
document.addEventListener("DOMContentLoaded", function () {

  function setupToggle(toggleSel, submenuSel, chevronSel) {
    const toggle = document.querySelector(toggleSel);
    const submenu = document.querySelector(submenuSel);
    const chevron = document.querySelector(chevronSel);

    if (!toggle || !submenu) return;

    toggle.addEventListener("click", function () {
      const isOpen = submenu.style.display === "block";
      submenu.style.display = isOpen ? "none" : "block";
      if (chevron) chevron.textContent = isOpen ? "â–¸" : "â–¾";
    });
  }

  setupToggle("[data-import-toggle]", "[data-import-submenu]", "[data-import-chevron]");
  setupToggle("[data-presentoir-toggle]", "[data-presentoir-submenu]", "[data-presentoir-chevron]");
});
</script>
